{"version":3,"sources":["vorton.ts"],"names":["Vorton","Vorton.elementHasClass","Vorton.isDescendantOrSame","Vorton.isEmptyNode","Vorton.eachRangeTextNode","Vorton.eachRangeTextNode.processTextNodeRange","Vorton.eachRangeTextNode.splitBreadthRange","Vorton.eachRangeTextNode.deeperRange","Vorton.eachRangeTextNode.processRange","Vorton.getRangeTextNodes","Vorton.splitHighlight","Vorton.highlight","Vorton.clear"],"mappings":"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","file":"vorton.js","sourcesContent":["module Vorton {\n\n  export function elementHasClass(element: HTMLElement, className: string) {\n    var elementClasses = element.className.split(' ');\n    return elementClasses.indexOf(className) !== -1;\n  }\n\n  function isDescendantOrSame(child, parent) {\n    var node = child;\n    while (node != null) {\n      if (node == parent) {\n        return true;\n      }\n      node = node.parentNode;\n    }\n    return false;\n  }\n\n  function isEmptyNode(node: Node) {\n    return !node.textContent.trim().length;\n  }\n\n\n  export function eachRangeTextNode(range: Range, fn: Function) {\n\n    function processTextNodeRange(range: Range) {\n\n      var textNode = <Text>range.startContainer;\n      var splittedTextNode = textNode\n        .splitText(range.startOffset)\n        .splitText(range.endOffset)\n        .previousSibling;\n\n      fn(splittedTextNode);\n    }\n\n    function splitBreadthRange(range: Range) {\n\n      var leftRange = document.createRange();\n      var rightRange = document.createRange();\n\n      leftRange.setStart(range.startContainer, range.startOffset);\n\n      if (range.startContainer.nodeType === Node.TEXT_NODE) {\n        leftRange.setEnd(range.startContainer, range.startContainer.textContent.length);\n      }\n      else {\n        leftRange.setEnd(range.startContainer, 0);\n      }\n\n      var leftRangeStartRoot = range.startContainer;\n\n      while (!leftRangeStartRoot.nextSibling) {\n        leftRangeStartRoot = leftRangeStartRoot.parentNode;\n      }\n\n      rightRange.setStart(leftRangeStartRoot.nextSibling, 0);\n      rightRange.setEnd(range.endContainer, range.endOffset);\n\n      processRange(leftRange);\n      processRange(rightRange);\n    }\n\n    function deeperRange(range: Range) {\n\n      var nextRange = document.createRange();\n      nextRange.setStart(range.startContainer.firstChild, 0);\n\n      if (range.startContainer === range.endContainer) {\n        var endContainer = range.startContainer.lastChild;\n\n        nextRange.setEnd(endContainer,\n          endContainer.nodeType === Node.TEXT_NODE ?\n            endContainer.textContent.length : 0);\n      }\n      else {\n        nextRange.setEnd(range.endContainer, range.endOffset);\n      }\n\n      processRange(nextRange);\n    }\n\n    function processRange(range: Range) {\n\n      if (range.startContainer === range.endContainer\n        && range.startContainer.nodeType === Node.TEXT_NODE) {\n        processTextNodeRange(range);\n      }\n      else if (isDescendantOrSame(range.endContainer, range.startContainer)) {\n        deeperRange(range);\n      }\n      else {\n        splitBreadthRange(range);\n      }\n    }\n\n    processRange(range);\n  }\n\n  export function getRangeTextNodes(range: Range): Array<Text> {\n    var textNodes = [];\n\n    eachRangeTextNode(range, textNode => textNodes.push(textNode));\n    return textNodes;\n  }\n\n  function splitHighlight(textNode: Text) {\n\n    var container = textNode.parentElement;\n    var previousSibling = <Text>textNode.previousSibling;\n    var nextSibling = <Text>textNode.nextSibling;\n\n    if (previousSibling && previousSibling.length) {\n      var beforeNode = document.createElement('SPAN');\n      beforeNode.className = container.className;\n      beforeNode.appendChild(previousSibling);\n\n      container.parentNode\n        .insertBefore(beforeNode, container);\n    }\n\n    container.parentNode\n      .insertBefore(textNode, container);\n\n    if (nextSibling && nextSibling.length) {\n      var afterNode = document.createElement('SPAN');\n      afterNode.className = container.className;\n      afterNode.appendChild(nextSibling);\n\n      container.parentNode\n        .insertBefore(afterNode, container);\n    }\n\n    container.parentNode\n      .removeChild(container);\n  }\n\n  export function highlight(range: Range, className: string, genericClassName?: string) {\n\n    eachRangeTextNode(range, function(node: Text) {\n\n      if (!isEmptyNode(node)) {\n\n        if (elementHasClass(node.parentElement, genericClassName)) {\n          splitHighlight(node);\n        }\n\n        var wrapper = document.createElement('SPAN');\n        node.parentNode.insertBefore(wrapper, node);\n        wrapper.className = (genericClassName ? genericClassName + ' ' : '') + className;\n        wrapper.appendChild(node);\n        wrapper.normalize();\n        wrapper.parentNode.normalize();\n      }\n    });\n  }\n\n  export function clear(range: Range, genericClassName: string) {\n\n    eachRangeTextNode(range, function(textNode: Text) {\n\n      if (elementHasClass(textNode.parentElement, genericClassName)) {\n        splitHighlight(textNode);\n        textNode.normalize();\n        textNode.parentNode.normalize();\n      }\n    });\n  }\n\n}\n"],"sourceRoot":"/source/"}